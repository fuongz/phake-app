FROM node:18-alpine

ARG NODE_ENV=production
ENV NODE_ENV=$NODE_ENV

ARG PORT=3003
ENV PORT=$PORT

ARG CORS_WHITELIST_ORIGINS="*"
ENV CORS_WHITELIST_ORIGINS=$CORS_WHITELIST_ORIGINS

ARG DATABASE_NAME
ENV DATABASE_NAME=$DATABASE_NAME

ARG DATABASE_USER
ENV DATABASE_USER=$DATABASE_USER

ARG DATABASE_PASS
ENV DATABASE_PASS=$DATABASE_PASS

ARG DATABASE_HOST
ENV DATABASE_HOST=$DATABASE_HOST

ARG DATABASE_PORT
ENV DATABASE_PORT=$DATABASE_PORT

ARG REDIS_HOST="redis"
ENV REDIS_HOST=$REDIS_HOST

ARG REDIS_PORT
ENV REDIS_PORT=$REDIS_PORT

ARG REDIS_PASSWORD
ENV REDIS_PASSWORD=$REDIS_PASSWORD

ARG MONGO_URL="mongodb://mongo/hiip_devtools"
ENV MONGO_URL=$MONGO_URL

WORKDIR /user/src/app
COPY . .
RUN npm run build
USER node
CMD ["npm", "run", "start:prod"]
